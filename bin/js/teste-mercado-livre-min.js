var messageSuccess="Dados gravados com sucesso!",messageError="Um erro ocorreu no servidor!";angular.module("dataSeverProvider",[]).factory("serverDataProvider",["$http",function($http){var dataProvider;return{searchProduct:function(model,callback){console.log("serverDataProvider"+model),$http({method:"GET",url:"https://api.mercadolibre.com/sites/MLB/search?q="+model}).then(function(response){console.log(response.status),dataProvider=response.data.results,callback(response.data.results)}).catch(function(response){console.log(response.status),callback(response)})},autosuggest:function(model,callback){$http({method:"GET",url:"https://http2.mlstatic.com/resources/sites/MLB/autosuggest?callback=autocomplete.jsonpCallback&showFilters=true&limit=9&api_version=2&q="+model}).then(function(response){callback(response.data)}).catch(function(response){callback(response)})},dataProvider:dataProvider,getDescriptionItem:function(id,callback){$http({method:"GET",url:"https://api.mercadolibre.com/items/"+id+"/description"}).then(function(response){callback(response.data)}).catch(function(response){callback(response)})},searchItem:function(id,callback){$http({method:"GET",url:"https://api.mercadolibre.com/items/"+id}).then(function(response){callback(response.data)}).catch(function(response){callback(response)})}}}]),angular.module("registerClient",["dataSeverProvider"]).controller("registerController",["$scope","$rootScope","$routeParams",function($scope,$rootScope,$routeParams){$scope.list=[],""!=angular.element('input[type="search"]').val()&&angular.element('button[ng-id="searchBtn"]').trigger("click")}]);var app=angular.module("routeTest",["ngRoute","registerClient"]);app.config(function($routeProvider){$routeProvider.when("/item/:id",{templateUrl:"./view/html/viewProduct.html",controller:"infoProductController"}).when("/:itemToSearch",{templateUrl:"./view/html/viewList.html",controller:"searchProductController"}).when("/",{templateUrl:"./view/html/view.html",controller:"registerController"}).otherwise({redirectTo:"/"})}),$(document).ready(function(){console.log("start.js")}),console.log("Front end"),app.directive("formSearch",["serverDataProvider","$compile","$rootScope",function(serverDataProvider,$compile,$rootScope){return{restrict:"EA",templateUrl:"./view/html/formSearch.html",controller:"registerController",link:function(scope,element,attr){scope.send=function(){window.location.href="http://localhost:8080/#!/"+scope.itemSearch},scope.change=function(event){serverDataProvider.autosuggest(scope.itemSearch,function(data){})}}}}]),app.controller("searchProductController",["$scope","$routeParams","$rootScope",function($scope,$routeParams,$rootScope){$scope.itemToSearch=$routeParams.itemToSearch}]),app.directive("pageProducts",["serverDataProvider","$compile",function(serverDataProvider,$compile){return{restrict:"EA",templateUrl:"./view/html/pageProducts.html",controller:"searchProductController",link:function(scope,element,attr){scope.showList=!0,serverDataProvider.searchProduct(scope.itemSearch,function(data){scope.items=[],scope.list=data;var cont=0;console.log(scope.list),""==angular.element('input[type="search"]').val()&&(angular.element('input[type="search"]').val=scope.itemSearch);for(var i in scope.list){if(!(cont<4))break;scope.items.push({thumbnail:scope.list[i].thumbnail,title:scope.list[i].title,link:scope.list[i].permalink,price:scope.list[i].price,id:scope.list[i].id}),cont++,console.log(scope.items[i])}})}}}]),app.controller("infoProductController",["$scope","$routeParams","$rootScope",function($scope,$routeParams,$rootScope){$scope.id=$routeParams.id}]),app.directive("productInfos",["serverDataProvider","$compile","$rootScope",function(serverDataProvider,$compile,$rootScope){return{restrict:"EA",templateUrl:"./view/html/productInfo.html",controller:"infoProductController",link:function(scope,element,attr){scope.description="";var data;serverDataProvider.searchItem(scope.id,function(param){var width=(data=param).pictures[0].size.match(/(.*\d(?=x))/g),height=data.pictures[0].size.match(/([0-9])+$/g),htmlImg='<figure><img src="'+data.pictures[0].secure_url+'"  class="thumbProduct" width="'+width+'" height="'+height+'"/></figure>',htmlSaleProduct="<h2>"+data.title+'</h2><br> <span class="priceItem">R$'+data.price+'</span><br><button class="btnSale btn btn-primary"> Comprar </button>';angular.element("#imageProduct").html(htmlImg),angular.element("#sale_product").html(htmlSaleProduct),serverDataProvider.getDescriptionItem(scope.id,function(param){angular.element("#description").html(param.text)})})}}}]);