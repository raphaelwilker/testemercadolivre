var messageSuccess="Dados gravados com sucesso!",messageError="Um erro ocorreu no servidor!";angular.module("dataSeverProvider",[]).factory("serverDataProvider",["$http",function($http){var dataProvider;return{searchProduct:function(model,callback){console.log("serverDataProvider"+model),$http({method:"GET",url:"https://api.mercadolibre.com/sites/MLB/search?q="+model}).then(function(response){console.log(response.status),dataProvider=response.data.results,callback(response.data.results)}).catch(function(response){console.log(response.status),callback(response)})},autosuggest:function(model,callback){$http({method:"GET",url:"https://http2.mlstatic.com/resources/sites/MLB/autosuggest?callback=autocomplete.jsonpCallback&showFilters=true&limit=9&api_version=2&q="+model}).then(function(response){callback(response.data)}).catch(function(response){callback(response)})},dataProvider:dataProvider,getDescriptionItem:function(id,callback){$http({method:"GET",url:"https://api.mercadolibre.com/items/"+id+"/description"}).then(function(response){callback(response.data)}).catch(function(response){callback(response)})},searchItem:function(id,callback){$http({method:"GET",url:"https://api.mercadolibre.com/items/"+id}).then(function(response){callback(response.data)}).catch(function(response){callback(response)})}}}]),angular.module("registerClient",["dataSeverProvider"]).controller("registerController",["$scope","$rootScope",function($scope,$rootScope){console.log("Oi"),""!=angular.element('input[type="search"]').val()&&angular.element('button[ng-id="searchBtn"]').trigger("click")}]);var app=angular.module("routeTest",["ngRoute","registerClient"]);app.config(function($routeProvider){$routeProvider.when("/item/:id",{templateUrl:"./view/html/viewProduct.html",controller:"infoProductController"}).when("/",{templateUrl:"./view/html/viewList.html",controller:"registerController"}).otherwise({redirectTo:"/"})}),$(document).ready(function(){console.log("start.js")}),console.log("Front end"),app.directive("formSearch",["serverDataProvider","$compile","$rootScope",function(serverDataProvider,$compile,$rootScope){return{restrict:"EA",templateUrl:"./view/html/formSearch.html",controller:"registerController",link:function(scope,element,attr){scope.send=function(){"http://localhost:8080/#!/"!=window.location.href?window.location.href="http://localhost:8080/#!/":serverDataProvider.searchProduct(scope.itemSearch,function(data){$rootScope.$broadcast("listProducts",{list:data})})},scope.change=function(event){serverDataProvider.autosuggest(scope.itemSearch,function(data){})}}}}]),app.directive("pageProducts",["serverDataProvider","$compile","$rootScope",function(serverDataProvider,$compile,$rootScope){return{restrict:"EA",templateUrl:"./view/html/pageProducts.html",link:function(scope,element,attr){scope.showList=!1,$rootScope.$on("listProducts",function(event,list){scope.items=[];var cont=0;for(var i in list)for(var j in list[i]){if(!(cont<4))break;scope.items.push({thumbnail:list[i][j].thumbnail,title:list[i][j].title,link:list[i][j].permalink,price:list[i][j].price,id:list[i][j].id}),cont++}scope.showList=!0,console.log("scope.items: "+scope.items)})}}}]),app.controller("infoProductController",["$scope","$routeParams","$rootScope",function($scope,$routeParams,$rootScope){$scope.id=$routeParams.id}]),app.directive("productInfos",["serverDataProvider","$compile","$rootScope",function(serverDataProvider,$compile,$rootScope){return{restrict:"EA",templateUrl:"./view/html/productInfo.html",controller:"infoProductController",link:function(scope,element,attr){scope.description="";var data;serverDataProvider.searchItem(scope.id,function(param){var htmlImg='<figure><img src="'+(data=param).secure_thumbnail+'"  class="thumbProduct"/></figure>',htmlSaleProduct="<h2>"+data.title+'</h2><br> <span class="priceItem">R$'+data.price+'</span><br><button class="btnSale btn btn-primary"> Comprar </button>';angular.element("#imageProduct").html(htmlImg),angular.element("#sale_product").html(htmlSaleProduct),serverDataProvider.getDescriptionItem(scope.id,function(param){angular.element("#description").html(param.text)})})}}}]);